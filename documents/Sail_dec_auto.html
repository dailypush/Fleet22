<!DOCTYPE html>
<html>
<head>
    <title>Sail List by Tag Number</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <style>
        body {
            padding-top: 20px;
        }
        .container {
            max-width: 600px;
        }
    </style>

    <script>
        let sailsData = []; // Declare sailsData globally

        // Load the JSON file using fetch
        fetch('https://raw.githubusercontent.com/dailypush/Fleet22/main/data/sail_tags.json')
        .then(response => response.json())
        .then(data => {
            sailsData = data; // Assign data to global variable

            // Attach the event listener after data is fetched
            document.getElementById('hullNumber').addEventListener('input', function () {
                updateForm();
            });
        })
        .catch(error => {
            console.error('Error loading the sail data:', error);
        });

        // Function to update the form based on hull number
        function updateForm() {
            const hullNumber = document.getElementById('hullNumber').value.trim();
            const filteredData = sailsData.filter(sail => sail.Hull === hullNumber);

            if (filteredData.length > 0) {
                // Autofill owner and boat name (editable)
                document.getElementById('owner').value = filteredData[0].Purchaser;
                document.getElementById('boatName').value = filteredData[0].BoatName || 'Unknown Boat Name';

                // Populate dropdowns for Jibs, Spinnaker, and Main
                populateSailDropdown('jib1', filteredData, 'J');
                populateSailDropdown('jib2', filteredData, 'J');
                populateSailDropdown('spinnaker', filteredData, 'S89');
                populateSailDropdown('main', filteredData, 'M');
            } else {
                clearFields();
            }
        }

        // Helper function to populate sail dropdowns
        function populateSailDropdown(dropdownId, sails, sailType) {
            const dropdown = document.getElementById(dropdownId);
            dropdown.innerHTML = '<option value="">Select</option>'; // Reset options
            sails.forEach(sail => {
                if (sail['Sail Type'] === sailType) {
                    const option = document.createElement('option');
                    option.text = `Tag: ${sail['Certificate No.']} - Sailmaker: ${sail['Sailmaker']}`;
                    option.value = sail['Certificate No.'];
                    dropdown.add(option);
                }
            });
        }

        // Function to clear fields when no hull number is found
        function clearFields() {
            document.getElementById('owner').value = '';
            document.getElementById('boatName').value = '';
            document.getElementById('email').value = '';
            document.getElementById('mobile').value = '';
            document.getElementById('jib1').innerHTML = '<option value="">Select</option>';
            document.getElementById('jib2').innerHTML = '<option value="">Select</option>';
            document.getElementById('spinnaker').innerHTML = '<option value="">Select</option>';
            document.getElementById('main').innerHTML = '<option value="">Select</option>';
        }

        // Function to print sails
        function printSails() {
            var hullNumber = document.getElementById("hullNumber").value;
            var owner = document.getElementById("owner").value;
            var boatName = document.getElementById("boatName").value;
            var email = document.getElementById("email").value;
            var mobile = document.getElementById("mobile").value;

            var jib1Cert = document.getElementById("jib1").value;
            var jib2Cert = document.getElementById("jib2").value;
            var mainCert = document.getElementById("main").value;
            var spinnakerCert = document.getElementById("spinnaker").value;

            // Retrieve sail details including sailmaker
            var jib1Sail = getSailByCertificate(jib1Cert);
            var jib2Sail = getSailByCertificate(jib2Cert);
            var mainSail = getSailByCertificate(mainCert);
            var spinnakerSail = getSailByCertificate(spinnakerCert);

            var printContent = `
                <h2>Sail List for Hull ${hullNumber}</h2>
                <p><strong>Boat Name:</strong> ${boatName || 'Not Provided'}</p>
                <p><strong>Owner:</strong> ${owner}</p>
                <p><strong>Email:</strong> ${email || 'Not Provided'}</p>
                <p><strong>Mobile:</strong> ${mobile || 'Not Provided'}</p>
                <ul>
                    <li><strong>Jib 1:</strong> ${formatSailInfo(jib1Sail)}</li>
                    <li><strong>Jib 2:</strong> ${formatSailInfo(jib2Sail)}</li>
                    <li><strong>Main:</strong> ${formatSailInfo(mainSail)}</li>
                    <li><strong>Spinnaker:</strong> ${formatSailInfo(spinnakerSail)}</li>
                </ul>
            `;

            var printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Sail List</title>');
            printWindow.document.write('<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">');
            printWindow.document.write('</head><body>');
            printWindow.document.write('<div class="container mt-5">');
            printWindow.document.write(printContent);
            printWindow.document.write('</div>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // Helper function to retrieve sail by certificate number
        function getSailByCertificate(certNo) {
            return sailsData.find(function(sail) {
                return sail["Certificate No."] === certNo;
            });
        }

        // Helper function to format sail information
        function formatSailInfo(sail) {
            if (!sail) {
                return 'Not Selected';
            }
            return sail["Certificate No."] + " (" + sail["Delivery Date"] + ", " + sail["Sailmaker"] + ")";
        }
    </script>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Sail List by Tag Number</h1>
        <form>
            <div class="form-group">
                <label for="hullNumber">Enter Hull Number:</label>
                <input type="text" class="form-control" id="hullNumber" name="hullNumber" placeholder="Enter hull number">
            </div>

            <div class="form-group">
                <label for="owner">Owner:</label>
                <input type="text" class="form-control" id="owner" name="owner">
            </div>

            <div class="form-group">
                <label for="boatName">Boat Name:</label>
                <input type="text" class="form-control" id="boatName" name="boatName">
            </div>

            <div class="form-group">
                <label for="email">Email Address:</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="Enter email address">
            </div>

            <div class="form-group">
                <label for="mobile">Mobile Number:</label>
                <input type="tel" class="form-control" id="mobile" name="mobile" placeholder="Enter mobile number">
            </div>

            <h3>Select Sails</h3>

            <div class="form-group">
                <label for="jib1">Jib 1:</label>
                <select class="form-control" id="jib1" name="jib1">
                    <option value="">Select</option>
                </select>
            </div>

            <div class="form-group">
                <label for="jib2">Jib 2:</label>
                <select class="form-control" id="jib2" name="jib2">
                    <option value="">Select</option>
                </select>
            </div>

            <div class="form-group">
                <label for="main">Main:</label>
                <select class="form-control" id="main" name="main">
                    <option value="">Select</option>
                </select>
            </div>

            <div class="form-group">
                <label for="spinnaker">Spinnaker:</label>
                <select class="form-control" id="spinnaker" name="spinnaker">
                    <option value="">Select</option>
                </select>
            </div>

            <button type="button" class="btn btn-success" onclick="printSails()">Print</button>
        </form>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
